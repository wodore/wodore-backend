from django.conf import settings
from django.forms import ModelForm, ValidationError
from django.utils.safestring import mark_safe
from django.utils.translation import gettext_lazy as _


def required_i18n_fields_form(*fields):
    class TransForm(ModelForm):
        def clean(self):
            for field in fields:
                translations = [self.cleaned_data.get(f"{field}_{code}", None) for code in settings.LANGUAGE_CODES]
                if not any(translations):
                    raise ValidationError(
                        mark_safe(_(f"At least one <i>{field}</i> field under <b>Translations</b> is required."))
                    )

            return self.cleaned_data

    return TransForm

# Martin Vector Tile Server Configuration
# Documentation: https://maplibre.org/martin/

# PostgreSQL connection
postgres:
  # Pool size for database connections
  pool_size: 20

  # Default SRID for spatial queries
  default_srid: 4326

  # Automatically compute bounds for tables
  auto_bounds: quick

  # Explicitly define tables/views to serve as vector tiles
  tables:
    # Huts vector tiles (using view with precomputed JOINs)
    huts:
      # Layer ID (used in vector tiles)
      layer_id: huts

      # Schema and table/view name
      schema: public
      table: huts_for_tiles

      # Geometry column (PostGIS)
      geometry_column: location
      srid: 4326
      geometry_type: POINT

      # Properties to include in vector tiles
      # All fields from the huts_for_tiles view
      properties:
        # Core fields
        slug: text
        elevation: numeric
        capacity_open: int2
        capacity_closed: int2

        # Default language name with fallbacks
        name: text

        # Multilingual names (with fallbacks)
        name_de: text
        name_en: text
        name_fr: text
        name_it: text

        # Hut type slugs and order (instead of IDs)
        type_open_slug: text
        type_open_order: int2
        type_closed_slug: text
        type_closed_order: int2

        # Availability
        has_availability: bool

        # Owner information
        owner_slug: text
        owner_name: text

        # Organization sources (JSON array)
        sources: text

      # Note: View automatically filters to is_public=true AND is_active=true

      # Tile extent in tile coordinate space (default: 4096)
      extent: 4096

      # Buffer size in pixels (helps prevent label/line clipping at tile edges)
      buffer: 64

      # Clip geometries to tile bounds (recommended for points)
      clip_geom: true

      # Support all zoom levels (0-20+)
      minzoom: 0
      maxzoom: 20

    ## # Ski routes (test data from Alps.sqlite)
    ## test_ski_routes:
    ##   layer_id: ski_routes

    ##   schema: public
    ##   table: test_ski_routes

    ##   geometry_column: geometry
    ##   srid: 4326
    ##   geometry_type: LINESTRING

    ##   properties:
    ##     id: int4
    ##     start: text
    ##     stop: text
    ##     diff: int4
    ##     length: float8
    ##     skitour: int8
    ##     pop: int4
    ##     adiff: text

    ##   extent: 4096
    ##   buffer: 64
    ##   clip_geom: true

    ##   minzoom: 0
    ##   maxzoom: 14

    ## # Swiss ski segments (test data from Switzerland_Segments.geojson)
    ## test_ski_routes_geojson:
    ##   layer_id: ski_segments

    ##   schema: public
    ##   table: test_ski_routes_geojson

    ##   geometry_column: geometry
    ##   srid: 4326
    ##   geometry_type: LINESTRING

    ##   properties:
    ##     id: int4

    ##   extent: 4096
    ##   buffer: 64
    ##   clip_geom: true

    ##   minzoom: 0
    ##   maxzoom: 14
sprites:
  # Size of the sprite cache (in MB).
  # Defaults to cache_size_mb / 8
  cache_size_mb: 64

  paths:
    # - ${MARTIN_SYNC_MOUNT:-/martin_sync}/sprites/CATEGORY1

  #sources:
  #  # SVG images in this directory will be published as a "categories" sprite source
  #  # Default: /sprite/sprites (mounted in docker-compose from ./martin_sync/sprites)
  #  # Production: /sprite/sprites (mounted from PVC after martin_sync command)
  #  categories: ${SPRITE_PATH:-/sprite/sprites}
# MBTiles file sources
# Martin can serve MBTiles files directly - add paths here
## mbtiles:
##   paths: /mbtiles/

# MapLibre styles
# Point to directory containing style JSON files
styles:
  paths: ${MARTIN_SYNC_MOUNT:-/martin_sync}/styles
